# Go 1.16

Go 1.16 был выпущен в феврале 2021 года.

## Embedding файлов в бинарник (`embed` пакет)

Добавлена поддержка встраивания (embedding) файлов прямо в бинарник с помощью нового пакета `embed` и директивы `//go:embed`. Позволяет включать статические файлы (например, HTML, CSS, JavaScript, изображения) непосредственно в ваш исполняемый файл Go.

```go
package main

import (
    "embed"
    "fmt"
)

//go:embed version.txt
var version string

//go:embed templates/*.html
var templates embed.FS

func main() {
    fmt.Println("Версия:", version)
    
    // Чтение файла из embedded файловой системы
    content, _ := templates.ReadFile("templates/index.html")
    fmt.Println(string(content))
}
```

## Новые функции для работы с `errors`

* `errors.As`: Позволяет вам проверять, является ли ошибка определенным типом, и извлекать значение этого типа. Это заменяет некоторые распространенные идиомы использования `type assertion` с ошибками. `go var pathError *os.PathError if errors.As(err, &pathError) { fmt.Println("Failed to open:", pathError.Path) }`
* `errors.Unwrap`: Возвращает обернутую ошибку (если ошибка была обернута с помощью `fmt.Errorf("%w", err))`. Используется для итерации по цепочке обернутых ошибок.

## `io/fs` пакет

Обобщенный интерфейс файловой системы. Позволяет работать с различными источниками данных как с файловой системой, включая встроенные ресурсы (`embed.FS`).

* `fs.FS` — интерфейс для файловой системы.
* `fs.ReadFile`, `fs.Glob`, `fs.WalkDir` и др.

```go
var myFS embed.FS

data, err := fs.ReadFile(myFS, "config.json")
```

## Изменения в модульной системе (Modules)

В Go 1.16 модули включены по умолчанию. Это означает, что вам больше не нужно явно устанавливать переменную окружения `GO111MODULE=on`.
* Удалён `GOPROXY` по умолчанию `GOPROXY=https://proxy.golang.org,direct`.
* При работе вне `GOPATH` и без `go.mod` теперь автоматически создаётся временный модуль (вместо ошибки), что упрощает эксперименты.
* Команда `go install` теперь работает в режиме модулей по умолчанию.

## Поддержка Apple Silicon (ARM64 на macOS)

Go 1.16 добавил официальную поддержку macOS на процессорах Apple M1 (ARM64):
```bash
GOOS=darwin GOARCH=arm64 go build
```

## Переход на использование `//go:build` (вместо `// +build`)

Хотя `// +build` пока работает, Go 1.16 начал переход к новому, более читаемому синтаксису для условной компиляции:
```bash
//go:build (linux && 386) || (darwin && !cgo)
```
вместо старого:
```bash
// +build linux,386 darwin,!cgo
```

## Улучшения производительности и сборки мусора

* Улучшена производительность сборки мусора, особенно для больших куч.
* Внесены оптимизации в компилятор и runtime.

## Новый флаг `-overlay` для `go build`

Позволяет переопределять файлы в проекте без их изменения (удобно для кодогенерации).

## Улучшения `go vet`

Новые проверки, включая обнаружение неиспользуемых результатов функций вроде `context.WithCancel`.

## Ускорение компоновщика (Linker Improvements)

Уменьшено время линковки (до 20-25% быстрее для больших проектов).

## Новые API в стандартной библиотеке

`os.ReadDir` — более эффективная замена `ioutil.ReadDir`.
`io.ReadAll` — замена `ioutil.ReadAll`.
Добавлены `io.ReadSeekCloser` и другие полезные интерфейсы.

## Отказ от `ioutil`

Пакет `ioutil` помечен как `deprecated` — функции перемещены в `os` и `io`.

## Изменения в работе cgo

Улучшена совместимость с `-static` и исправлены баги.

## Удаление устаревших функций

Некоторые устаревшие API были удалены, например:

`os.SameFile` теперь требует `os.FileInfo`, а не `os.File`.
Удалены устаревшие функции в `crypto/x509`, `net`, `syscall`.

## Улучшения
Новые функции в `strings.Cut`, `strings.Clone` и `slices`
